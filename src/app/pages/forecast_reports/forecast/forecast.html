<h1 class="text-3xl font-bold mb-4">ðŸ“… Harvest Forecast</h1>

<div class="grid grid-cols-12 gap-6 p-4">
    <div class="col-span-12 lg:col-span-6">
        <div class="app-dashboard-card border-t-4 border-blue-500 p-4 rounded-lg shadow-lg bg-white dark:bg-gray-800 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
            <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300 mb-3 border-b pb-2">Projected Tonnage by Product (Tonnes)</h3>

            @if (chartData) {
            <p-chart type="bar" [data]="chartData" [options]="chartOptions"></p-chart>
            } @else {
            <div class="text-center text-gray-500 py-6">Loading chart data...</div>
            }
        </div>
    </div>

    <div class="col-span-12 lg:col-span-6">
        <div class="app-dashboard-card border-t-4 border-blue-500 p-4 rounded-lg shadow-lg bg-white dark:bg-gray-800 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
            <h3 class="text-lg font-bold text-gray-700 dark:text-gray-300 mb-3 border-b pb-2">Monthly Harvest Schedule (Tonnes)</h3>

            <p-table [value]="getAggregatedTableData()" [tableStyle]="{'min-width': '50rem'}" styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                    <tr>
                        <th class="text-blue-600 dark:text-blue-400 font-extrabold text-sm">Product</th>
                        @for (col of monthColumns; track col.field) {
                        <th class="text-center font-bold text-sm">{{ col.header | uppercase }}</th>
                        }
                        <th class="text-center font-extrabold text-sm bg-gray-100 dark:bg-gray-700">ROW TOTAL</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-rowData>
                    <tr>
                        <td class="font-semibold">{{ rowData.product }}</td>
                        @for (col of monthColumns; track col.field) {
                        <td class="text-center">
                            <span [ngClass]="rowData[col.field] > 0 ? 'font-extrabold text-blue-600 dark:text-blue-400' : 'text-gray-400'"> {{ rowData[col.field] | number:'1.0-2' }} </span>
                        </td>
                        }
                        <td class="text-center font-extrabold text-md bg-gray-50 dark:bg-gray-700">{{ rowData.totalTonnes | number:'1.0-2' }}</td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="footer">
                    <tr>
                        <td><span class="font-extrabold text-blue-600">MONTHLY TOTAL</span></td>
                        @for (col of monthColumns; track col.field) {
                        <td class="text-center font-extrabold text-lg text-blue-600 dark:text-blue-400">{{ col.total | number:'1.0-2' }}</td>
                        }
                        <td class="text-center font-extrabold text-xl text-green-600 dark:text-green-400 bg-gray-100 dark:bg-gray-800">{{ totalForecastTonnes | number:'1.0-2' }}</td>
                    </tr>
                </ng-template>
            </p-table>

            <div class="mt-4 pt-2 border-t flex justify-between items-center text-sm">
                <span class="text-primary font-medium text-blue-500">Basis:</span>
                <span class="text-gray-500 dark:text-gray-400 font-semibold"> 5-Month Growout Cycle | Data from {{ getActiveStockingCount() }} tanks </span>
            </div>
        </div>
    </div>

    <div class="col-span-12">
        <div class="app-dashboard-card border-t-4 border-yellow-500 p-4 rounded-lg shadow-lg bg-white dark:bg-gray-800 transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
            <h3 class="text-lg font-bold mb-3 border-b pb-2">Growout Summary</h3>
            <div class="grid grid-cols-12 gap-4">
                <div class="col-span-12 sm:col-span-4">
                    <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Next Critical Harvest Month:</span>
                    <p class="text-2xl font-extrabold text-blue-600 dark:text-blue-400">{{ nextHarvestMonthName }}</p>
                </div>

                <div class="col-span-12 sm:col-span-4">
                    <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Active Growout Cycles:</span>
                    <p class="text-2xl font-extrabold text-blue-600 dark:text-blue-400">{{ getActiveStockingCount() }} Tanks</p>
                </div>

                <div class="col-span-12 sm:col-span-4">
                    <span class="font-semibold text-sm text-gray-700 dark:text-gray-300">Projected Total Tonnes (4 Months):</span>
                    <p class="text-2xl font-extrabold text-green-600 dark:text-green-400">{{ totalForecastTonnes | number:'1.0-2' }} T</p>
                </div>
            </div>
        </div>
    </div>
</div>
